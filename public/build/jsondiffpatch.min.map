{"version":3,"sources":["/source-files/jsondiffpatch/node_modules/fiberglass/node_modules/browserify/node_modules/browser-pack/_prelude.js","/source-files/jsondiffpatch/src/main.js","/source-files/jsondiffpatch/src/environment.js","/source-files/jsondiffpatch/src/diffpatcher.js","/source-files/jsondiffpatch/src/date-reviver.js","/source-files/jsondiffpatch/src/processor.js","/source-files/jsondiffpatch/src/pipe.js","/source-files/jsondiffpatch/src/contexts/diff.js","/source-files/jsondiffpatch/src/contexts/patch.js","/source-files/jsondiffpatch/src/contexts/reverse.js","/source-files/jsondiffpatch/src/clone.js","/source-files/jsondiffpatch/src/filters/trivial.js","/source-files/jsondiffpatch/src/filters/nested.js","/source-files/jsondiffpatch/src/filters/arrays.js","/source-files/jsondiffpatch/src/filters/dates.js","/source-files/jsondiffpatch/src/filters/texts.js","/source-files/jsondiffpatch/src/contexts/context.js","/source-files/jsondiffpatch/src/filters/lcs.js"],"names":["environment","require","DiffPatcher","exports","create","options","dateReviver","defaultInstance","diff","apply","arguments","patch","unpatch","reverse","clone","isBrowser","homepage","version","packageInfoModuleName","packageInfo","formatterModuleName","formatters","console","window","Processor","Pipe","DiffContext","PatchContext","ReverseContext","trivial","nested","arrays","dates","texts","this","processor","pipe","append","collectChildrenDiffFilter","diffFilter","objectsDiffFilter","shouldHaveResult","collectChildrenPatchFilter","patchFilter","collectChildrenReverseFilter","reverseFilter","prototype","left","right","process","delta","value","module","key","parts","exec","Date","UTC","selfOptions","pipes","name","input","context","lastPipe","lastContext","nextPipe","nextAfterChildren","next","hasResult","result","undefined","filters","Error","debug","length","index","filter","log","filterName","exiting","resultCheck","msg","push","prepend","unshift","indexOf","list","names","after","params","Array","slice","call","splice","before","replace","remove","clear","should","error","noResult","Context","defaultClone","setResult","cloneDiffValues","cloneRegExp","re","regexMatch","toString","RegExp","arg","isArray","map","getTime","cloned","Object","hasOwnProperty","a","exit","leftType","rightType","leftIsArray","rightIsArray","regexArgs","children","child","childName","_t","propertyFilter","arraysHaveMatchByRef","array1","array2","len1","len2","index1","val1","index2","val2","matchItems","value1","value2","objectHash","matchByPosition","hash1","hash2","hashCache1","hashCache2","lcs","ARRAY_MOVE","arrayIndexOf","array","item","i","matchContext","commonHead","commonTail","trimmed1","trimmed2","seq","get","removedItems","indices1","detectMove","includeValueOnMove","removedItemsLength","indexOnArray2","indices2","isMove","removeItemIndex1","compare","numerically","b","numericallyBy","toRemove","toInsert","toModify","parseInt","sort","indexDiff","removedValue","toInsertLength","insertion","toModifyLength","modification","newName","substr","reverseArrayDeltaIndex","itemDelta","reverseIndex","deltaIndex","deltaItem","moveFromIndex","moveToIndex","deleteIndex","TEXT_DIFF","DEFAULT_MIN_LENGTH","cachedDiffPatch","getDiffMatchPatch","required","instance","diff_match_patch","dmpModuleName","dmp","err","diff_match_patch_not_found","txt1","txt2","patch_toText","patch_make","results","patch_apply","patch_fromText","textPatchFailed","minLength","textDiff","diffMatchPatch","textDeltaReverse","l","lines","line","lineTmp","lineHeader","lineAdd","lineRemove","header","headerRegex","split","lineStart","join","switchTo","parent","root","defaultMatch","lengthMatrix","match","x","y","matrix","Math","max","backtrack","sequence","subsequence"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\nvar environment = require('./environment');\n\nvar DiffPatcher = require('./diffpatcher').DiffPatcher;\nexports.DiffPatcher = DiffPatcher;\n\nexports.create = function(options){\n  return new DiffPatcher(options);\n};\n\nexports.dateReviver = require('./date-reviver');\n\nvar defaultInstance;\n\nexports.diff = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.diff.apply(defaultInstance, arguments);\n};\n\nexports.patch = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.patch.apply(defaultInstance, arguments);\n};\n\nexports.unpatch = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.unpatch.apply(defaultInstance, arguments);\n};\n\nexports.reverse = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.reverse.apply(defaultInstance, arguments);\n};\n\nexports.clone = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.clone.apply(defaultInstance, arguments);\n};\n\n\nif (environment.isBrowser) {\n  exports.homepage = '{{package-homepage}}';\n  exports.version = '{{package-version}}';\n} else {\n  var packageInfoModuleName = '../package.json';\n  var packageInfo = require(packageInfoModuleName);\n  exports.homepage = packageInfo.homepage;\n  exports.version = packageInfo.version;\n\n  var formatterModuleName = './formatters';\n  var formatters = require(formatterModuleName);\n  exports.formatters = formatters;\n  // shortcut for console\n  exports.console = formatters.console;\n}\n","\nexports.isBrowser = typeof window !== 'undefined';\n","var Processor = require('./processor').Processor;\nvar Pipe = require('./pipe').Pipe;\nvar DiffContext = require('./contexts/diff').DiffContext;\nvar PatchContext = require('./contexts/patch').PatchContext;\nvar ReverseContext = require('./contexts/reverse').ReverseContext;\n\nvar clone = require('./clone');\n\nvar trivial = require('./filters/trivial');\nvar nested = require('./filters/nested');\nvar arrays = require('./filters/arrays');\nvar dates = require('./filters/dates');\nvar texts = require('./filters/texts');\n\nvar DiffPatcher = function DiffPatcher(options) {\n  this.processor = new Processor(options);\n  this.processor.pipe(new Pipe('diff').append(\n    nested.collectChildrenDiffFilter,\n    trivial.diffFilter,\n    dates.diffFilter,\n    texts.diffFilter,\n    nested.objectsDiffFilter,\n    arrays.diffFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('patch').append(\n    nested.collectChildrenPatchFilter,\n    arrays.collectChildrenPatchFilter,\n    trivial.patchFilter,\n    texts.patchFilter,\n    nested.patchFilter,\n    arrays.patchFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('reverse').append(\n    nested.collectChildrenReverseFilter,\n    arrays.collectChildrenReverseFilter,\n    trivial.reverseFilter,\n    texts.reverseFilter,\n    nested.reverseFilter,\n    arrays.reverseFilter\n  ).shouldHaveResult());\n};\n\nDiffPatcher.prototype.options = function() {\n  return this.processor.options.apply(this.processor, arguments);\n};\n\nDiffPatcher.prototype.diff = function(left, right) {\n  return this.processor.process(new DiffContext(left, right));\n};\n\nDiffPatcher.prototype.patch = function(left, delta) {\n  return this.processor.process(new PatchContext(left, delta));\n};\n\nDiffPatcher.prototype.reverse = function(delta) {\n  return this.processor.process(new ReverseContext(delta));\n};\n\nDiffPatcher.prototype.unpatch = function(right, delta) {\n  return this.patch(right, this.reverse(delta));\n};\n\nDiffPatcher.prototype.clone = function(value) {\n  return clone(value);\n};\n\nexports.DiffPatcher = DiffPatcher;\n","// use as 2nd parameter for JSON.parse to revive Date instances\nmodule.exports = function dateReviver(key, value) {\n  var parts;\n  if (typeof value === 'string') {\n    parts = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d*))?(Z|([+\\-])(\\d{2}):(\\d{2}))$/.exec(value);\n    if (parts) {\n      return new Date(Date.UTC(+parts[1], +parts[2] - 1, +parts[3], +parts[4], +parts[5], +parts[6], +(parts[7] || 0)));\n    }\n  }\n  return value;\n};\n","\nvar Processor = function Processor(options){\n  this.selfOptions = options || {};\n  this.pipes = {};\n};\n\nProcessor.prototype.options = function(options) {\n  if (options) {\n    this.selfOptions = options;\n  }\n  return this.selfOptions;\n};\n\nProcessor.prototype.pipe = function(name, pipe) {\n  if (typeof name === 'string') {\n    if (typeof pipe === 'undefined') {\n      return this.pipes[name];\n    } else {\n      this.pipes[name] = pipe;\n    }\n  }\n  if (name && name.name) {\n    pipe = name;\n    if (pipe.processor === this) { return pipe; }\n    this.pipes[pipe.name] = pipe;\n  }\n  pipe.processor = this;\n  return pipe;\n};\n\nProcessor.prototype.process = function(input, pipe) {\n  var context = input;\n  context.options = this.options();\n  var nextPipe = pipe || input.pipe || 'default';\n  var lastPipe, lastContext;\n  while (nextPipe) {\n    if (typeof context.nextAfterChildren !== 'undefined') {\n      // children processed and coming back to parent\n      context.next = context.nextAfterChildren;\n      context.nextAfterChildren = null;\n    }\n\n    if (typeof nextPipe === 'string') {\n      nextPipe = this.pipe(nextPipe);\n    }\n    nextPipe.process(context);\n    lastContext = context;\n    lastPipe = nextPipe;\n    nextPipe = null;\n    if (context) {\n      if (context.next) {\n        context = context.next;\n        nextPipe = lastContext.nextPipe || context.pipe || lastPipe;\n      }\n    }\n  }\n  return context.hasResult ? context.result : undefined;\n};\n\nexports.Processor = Processor;\n","var Pipe = function Pipe(name) {\n  this.name = name;\n  this.filters = [];\n};\n\nPipe.prototype.process = function(input) {\n  if (!this.processor) {\n    throw new Error('add this pipe to a processor before using it');\n  }\n  var debug = this.debug;\n  var length = this.filters.length;\n  var context = input;\n  for (var index = 0; index < length; index++) {\n    var filter = this.filters[index];\n    if (debug) {\n      this.log('filter: ' + filter.filterName);\n    }\n    filter(context);\n    if (typeof context === 'object' && context.exiting) {\n      context.exiting = false;\n      break;\n    }\n  }\n  if (!context.next && this.resultCheck) {\n    this.resultCheck(context);\n  }\n};\n\nPipe.prototype.log = function(msg) {\n  console.log('[jsondiffpatch] ' + this.name + ' pipe, ' + msg);\n};\n\nPipe.prototype.append = function() {\n  this.filters.push.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.prepend = function() {\n  this.filters.unshift.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.indexOf = function(filterName) {\n  if (!filterName) {\n    throw new Error('a filter name is required');\n  }\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    if (filter.filterName === filterName) {\n      return index;\n    }\n  }\n  throw new Error('filter not found: ' + filterName);\n};\n\nPipe.prototype.list = function() {\n  var names = [];\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    names.push(filter.filterName);\n  }\n  return names;\n};\n\nPipe.prototype.after = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index + 1, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.before = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.replace = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index, 1);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.remove = function(filterName) {\n  var index = this.indexOf(filterName);\n  this.filters.splice(index, 1);\n  return this;\n};\n\nPipe.prototype.clear = function() {\n  this.filters.length = 0;\n  return this;\n};\n\nPipe.prototype.shouldHaveResult = function(should) {\n  if (should === false) {\n    this.resultCheck = null;\n    return;\n  }\n  if (this.resultCheck) {\n    return;\n  }\n  var pipe = this;\n  this.resultCheck = function(context) {\n    if (!context.hasResult) {\n      console.log(context);\n      var error = new Error(pipe.name + ' failed');\n      error.noResult = true;\n      throw error;\n    }\n  };\n  return this;\n};\n\nexports.Pipe = Pipe;\n","var Context = require('./context').Context;\nvar defaultClone = require('../clone');\n\nvar DiffContext = function DiffContext(left, right) {\n  this.left = left;\n  this.right = right;\n  this.pipe = 'diff';\n};\n\nDiffContext.prototype = new Context();\n\nDiffContext.prototype.setResult = function(result) {\n  if (this.options.cloneDiffValues && typeof result === 'object') {\n    var clone = typeof this.options.cloneDiffValues === 'function' ?\n      this.options.cloneDiffValues : defaultClone;\n    if (typeof result[0] === 'object') {\n      result[0] = clone(result[0]);\n    }\n    if (typeof result[1] === 'object') {\n      result[1] = clone(result[1]);\n    }\n  }\n  return Context.prototype.setResult.apply(this, arguments);\n};\n\nexports.DiffContext = DiffContext;\n","var Context = require('./context').Context;\n\nvar PatchContext = function PatchContext(left, delta) {\n  this.left = left;\n  this.delta = delta;\n  this.pipe = 'patch';\n};\n\nPatchContext.prototype = new Context();\n\nexports.PatchContext = PatchContext;\n","var Context = require('./context').Context;\n\nvar ReverseContext = function ReverseContext(delta) {\n  this.delta = delta;\n  this.pipe = 'reverse';\n};\n\nReverseContext.prototype = new Context();\n\nexports.ReverseContext = ReverseContext;\n","\nvar isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nfunction cloneRegExp(re) {\n  var regexMatch = /^\\/(.*)\\/([gimyu]*)$/.exec(re.toString());\n  return new RegExp(regexMatch[1], regexMatch[2]);\n}\n\nfunction clone(arg) {\n  if (typeof arg !== 'object') {\n    return arg;\n  }\n  if (arg === null) {\n    return null;\n  }\n  if (isArray(arg)) {\n    return arg.map(clone);\n  }\n  if (arg instanceof Date) {\n    return new Date(arg.getTime());\n  }\n  if (arg instanceof RegExp) {\n    return cloneRegExp(arg);\n  }\n  var cloned = {};\n  for (var name in arg) {\n    if (Object.prototype.hasOwnProperty.call(arg, name)) {\n      cloned[name] = clone(arg[name]);\n    }\n  }\n  return cloned;\n}\n\nmodule.exports = clone;\n","var isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar diffFilter = function trivialMatchesDiffFilter(context) {\n  if (context.left === context.right) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  if (typeof context.left === 'undefined') {\n    if (typeof context.right === 'function') {\n      throw new Error('functions are not supported');\n    }\n    context.setResult([context.right]).exit();\n    return;\n  }\n  if (typeof context.right === 'undefined') {\n    context.setResult([context.left, 0, 0]).exit();\n    return;\n  }\n  if (typeof context.left === 'function' || typeof context.right === 'function') {\n    throw new Error('functions are not supported');\n  }\n  context.leftType = context.left === null ? 'null' : typeof context.left;\n  context.rightType = context.right === null ? 'null' : typeof context.right;\n  if (context.leftType !== context.rightType) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'boolean' || context.leftType === 'number') {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'object') {\n    context.leftIsArray = isArray(context.left);\n  }\n  if (context.rightType === 'object') {\n    context.rightIsArray = isArray(context.right);\n  }\n  if (context.leftIsArray !== context.rightIsArray) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n\n  if (context.left instanceof RegExp) {\n    if (context.right instanceof RegExp) {\n      context.setResult([context.left.toString(), context.right.toString()]).exit();\n    } else {\n      context.setResult([context.left, context.right]).exit();\n      return;\n    }\n  }\n};\ndiffFilter.filterName = 'trivial';\n\nvar patchFilter = function trivialMatchesPatchFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult(context.delta[0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    if (context.left instanceof RegExp) {\n      var regexArgs = /^\\/(.*)\\/([gimyu]+)$/.exec(context.delta[1]);\n      if (regexArgs) {\n        context.setResult(new RegExp(regexArgs[1], regexArgs[2])).exit();\n        return;\n      }\n    }\n    context.setResult(context.delta[1]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n};\npatchFilter.filterName = 'trivial';\n\nvar reverseFilter = function trivialReferseFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.delta).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult([context.delta[0], 0, 0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult([context.delta[1], context.delta[0]]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult([context.delta[0]]).exit();\n    return;\n  }\n};\nreverseFilter.filterName = 'trivial';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar collectChildrenDiffFilter = function collectChildrenDiffFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var result = context.result;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (typeof child.result === 'undefined') {\n      continue;\n    }\n    result = result || {};\n    result[child.childName] = child.result;\n  }\n  if (result && context.leftIsArray) {\n    result._t = 'a';\n  }\n  context.setResult(result).exit();\n};\ncollectChildrenDiffFilter.filterName = 'collectChildren';\n\nvar objectsDiffFilter = function objectsDiffFilter(context) {\n  if (context.leftIsArray || context.leftType !== 'object') {\n    return;\n  }\n\n  var name, child, propertyFilter = context.options.propertyFilter;\n  for (name in context.left) {\n    if (!Object.prototype.hasOwnProperty.call(context.left, name)) {\n      continue;\n    }\n    if (propertyFilter && !propertyFilter(name, context)) {\n      continue;\n    }\n    child = new DiffContext(context.left[name], context.right[name]);\n    context.push(child, name);\n  }\n  for (name in context.right) {\n    if (!Object.prototype.hasOwnProperty.call(context.right, name)) {\n      continue;\n    }\n    if (propertyFilter && !propertyFilter(name, context)) {\n      continue;\n    }\n    if (typeof context.left[name] === 'undefined') {\n      child = new DiffContext(undefined, context.right[name]);\n      context.push(child, name);\n    }\n  }\n\n  if (!context.children || context.children.length === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  context.exit();\n};\nobjectsDiffFilter.filterName = 'objects';\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new PatchContext(context.left[name], context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\npatchFilter.filterName = 'objects';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (Object.prototype.hasOwnProperty.call(context.left, child.childName) && child.result === undefined) {\n      delete context.left[child.childName];\n    } else if (context.left[child.childName] !== child.result) {\n      context.left[child.childName] = child.result;\n    }\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'collectChildren';\n\nvar reverseFilter = function nestedReverseFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'objects';\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {};\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (delta[child.childName] !== child.result) {\n      delta[child.childName] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'collectChildren';\n\nexports.collectChildrenDiffFilter = collectChildrenDiffFilter;\nexports.objectsDiffFilter = objectsDiffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar lcs = require('./lcs');\n\nvar ARRAY_MOVE = 3;\n\nvar isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar arrayIndexOf = typeof Array.prototype.indexOf === 'function' ?\n  function(array, item) {\n    return array.indexOf(item);\n  } : function(array, item) {\n    var length = array.length;\n    for (var i = 0; i < length; i++) {\n      if (array[i] === item) {\n        return i;\n      }\n    }\n    return -1;\n  };\n\nfunction arraysHaveMatchByRef(array1, array2, len1, len2) {\n  for (var index1 = 0; index1 < len1; index1++) {\n    var val1 = array1[index1];\n    for (var index2 = 0; index2 < len2; index2++) {\n      var val2 = array2[index2];\n      if (index1 !== index2 && val1 === val2) {\n        return true;\n      }\n    }\n  }\n}\n\nfunction matchItems(array1, array2, index1, index2, context) {\n  var value1 = array1[index1];\n  var value2 = array2[index2];\n  if (value1 === value2) {\n    return true;\n  }\n  if (typeof value1 !== 'object' || typeof value2 !== 'object') {\n    return false;\n  }\n  var objectHash = context.objectHash;\n  if (!objectHash) {\n    // no way to match objects was provided, try match by position\n    return context.matchByPosition && index1 === index2;\n  }\n  var hash1;\n  var hash2;\n  if (typeof index1 === 'number') {\n    context.hashCache1 = context.hashCache1 || [];\n    hash1 = context.hashCache1[index1];\n    if (typeof hash1 === 'undefined') {\n      context.hashCache1[index1] = hash1 = objectHash(value1, index1);\n    }\n  } else {\n    hash1 = objectHash(value1);\n  }\n  if (typeof hash1 === 'undefined') {\n    return false;\n  }\n  if (typeof index2 === 'number') {\n    context.hashCache2 = context.hashCache2 || [];\n    hash2 = context.hashCache2[index2];\n    if (typeof hash2 === 'undefined') {\n      context.hashCache2[index2] = hash2 = objectHash(value2, index2);\n    }\n  } else {\n    hash2 = objectHash(value2);\n  }\n  if (typeof hash2 === 'undefined') {\n    return false;\n  }\n  return hash1 === hash2;\n}\n\nvar diffFilter = function arraysDiffFilter(context) {\n  if (!context.leftIsArray) {\n    return;\n  }\n\n  var matchContext = {\n    objectHash: context.options && context.options.objectHash,\n    matchByPosition: context.options && context.options.matchByPosition\n  };\n  var commonHead = 0;\n  var commonTail = 0;\n  var index;\n  var index1;\n  var index2;\n  var array1 = context.left;\n  var array2 = context.right;\n  var len1 = array1.length;\n  var len2 = array2.length;\n\n  var child;\n\n  if (len1 > 0 && len2 > 0 && !matchContext.objectHash &&\n    typeof matchContext.matchByPosition !== 'boolean') {\n    matchContext.matchByPosition = !arraysHaveMatchByRef(array1, array2, len1, len2);\n  }\n\n  // separate common head\n  while (commonHead < len1 && commonHead < len2 &&\n    matchItems(array1, array2, commonHead, commonHead, matchContext)) {\n    index = commonHead;\n    child = new DiffContext(context.left[index], context.right[index]);\n    context.push(child, index);\n    commonHead++;\n  }\n  // separate common tail\n  while (commonTail + commonHead < len1 && commonTail + commonHead < len2 &&\n    matchItems(array1, array2, len1 - 1 - commonTail, len2 - 1 - commonTail, matchContext)) {\n    index1 = len1 - 1 - commonTail;\n    index2 = len2 - 1 - commonTail;\n    child = new DiffContext(context.left[index1], context.right[index2]);\n    context.push(child, index2);\n    commonTail++;\n  }\n  var result;\n  if (commonHead + commonTail === len1) {\n    if (len1 === len2) {\n      // arrays are identical\n      context.setResult(undefined).exit();\n      return;\n    }\n    // trivial case, a block (1 or more consecutive items) was added\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len2 - commonTail; index++) {\n      result[index] = [array2[index]];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  if (commonHead + commonTail === len2) {\n    // trivial case, a block (1 or more consecutive items) was removed\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len1 - commonTail; index++) {\n      result['_' + index] = [array1[index], 0, 0];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  // reset hash cache\n  delete matchContext.hashCache1;\n  delete matchContext.hashCache2;\n\n  // diff is not trivial, find the LCS (Longest Common Subsequence)\n  var trimmed1 = array1.slice(commonHead, len1 - commonTail);\n  var trimmed2 = array2.slice(commonHead, len2 - commonTail);\n  var seq = lcs.get(\n    trimmed1, trimmed2,\n    matchItems,\n    matchContext\n  );\n  var removedItems = [];\n  result = result || {\n    _t: 'a'\n  };\n  for (index = commonHead; index < len1 - commonTail; index++) {\n    if (arrayIndexOf(seq.indices1, index - commonHead) < 0) {\n      // removed\n      result['_' + index] = [array1[index], 0, 0];\n      removedItems.push(index);\n    }\n  }\n\n  var detectMove = true;\n  if (context.options && context.options.arrays && context.options.arrays.detectMove === false) {\n    detectMove = false;\n  }\n  var includeValueOnMove = false;\n  if (context.options && context.options.arrays && context.options.arrays.includeValueOnMove) {\n    includeValueOnMove = true;\n  }\n\n  var removedItemsLength = removedItems.length;\n  for (index = commonHead; index < len2 - commonTail; index++) {\n    var indexOnArray2 = arrayIndexOf(seq.indices2, index - commonHead);\n    if (indexOnArray2 < 0) {\n      // added, try to match with a removed item and register as position move\n      var isMove = false;\n      if (detectMove && removedItemsLength > 0) {\n        for (var removeItemIndex1 = 0; removeItemIndex1 < removedItemsLength; removeItemIndex1++) {\n          index1 = removedItems[removeItemIndex1];\n          if (matchItems(trimmed1, trimmed2, index1 - commonHead,\n            index - commonHead, matchContext)) {\n            // store position move as: [originalValue, newPosition, ARRAY_MOVE]\n            result['_' + index1].splice(1, 2, index, ARRAY_MOVE);\n            if (!includeValueOnMove) {\n              // don't include moved value on diff, to save bytes\n              result['_' + index1][0] = '';\n            }\n\n            index2 = index;\n            child = new DiffContext(context.left[index1], context.right[index2]);\n            context.push(child, index2);\n            removedItems.splice(removeItemIndex1, 1);\n            isMove = true;\n            break;\n          }\n        }\n      }\n      if (!isMove) {\n        // added\n        result[index] = [array2[index]];\n      }\n    } else {\n      // match, do inner diff\n      index1 = seq.indices1[indexOnArray2] + commonHead;\n      index2 = seq.indices2[indexOnArray2] + commonHead;\n      child = new DiffContext(context.left[index1], context.right[index2]);\n      context.push(child, index2);\n    }\n  }\n\n  context.setResult(result).exit();\n\n};\ndiffFilter.filterName = 'arrays';\n\nvar compare = {\n  numerically: function(a, b) {\n    return a - b;\n  },\n  numericallyBy: function(name) {\n    return function(a, b) {\n      return a[name] - b[name];\n    };\n  }\n};\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var index, index1;\n\n  var delta = context.delta;\n  var array = context.left;\n\n  // first, separate removals, insertions and modifications\n  var toRemove = [];\n  var toInsert = [];\n  var toModify = [];\n  for (index in delta) {\n    if (index !== '_t') {\n      if (index[0] === '_') {\n        // removed item from original array\n        if (delta[index][2] === 0 || delta[index][2] === ARRAY_MOVE) {\n          toRemove.push(parseInt(index.slice(1), 10));\n        } else {\n          throw new Error('only removal or move can be applied at original array indices' +\n            ', invalid diff type: ' + delta[index][2]);\n        }\n      } else {\n        if (delta[index].length === 1) {\n          // added item at new array\n          toInsert.push({\n            index: parseInt(index, 10),\n            value: delta[index][0]\n          });\n        } else {\n          // modified item at new array\n          toModify.push({\n            index: parseInt(index, 10),\n            delta: delta[index]\n          });\n        }\n      }\n    }\n  }\n\n  // remove items, in reverse order to avoid sawing our own floor\n  toRemove = toRemove.sort(compare.numerically);\n  for (index = toRemove.length - 1; index >= 0; index--) {\n    index1 = toRemove[index];\n    var indexDiff = delta['_' + index1];\n    var removedValue = array.splice(index1, 1)[0];\n    if (indexDiff[2] === ARRAY_MOVE) {\n      // reinsert later\n      toInsert.push({\n        index: indexDiff[1],\n        value: removedValue\n      });\n    }\n  }\n\n  // insert items, in reverse order to avoid moving our own floor\n  toInsert = toInsert.sort(compare.numericallyBy('index'));\n  var toInsertLength = toInsert.length;\n  for (index = 0; index < toInsertLength; index++) {\n    var insertion = toInsert[index];\n    array.splice(insertion.index, 0, insertion.value);\n  }\n\n  // apply modifications\n  var toModifyLength = toModify.length;\n  var child;\n  if (toModifyLength > 0) {\n    for (index = 0; index < toModifyLength; index++) {\n      var modification = toModify[index];\n      child = new PatchContext(context.left[modification.index], modification.delta);\n      context.push(child, modification.index);\n    }\n  }\n\n  if (!context.children) {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.exit();\n};\npatchFilter.filterName = 'arrays';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    context.left[child.childName] = child.result;\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'arraysCollectChildren';\n\nvar reverseFilter = function arraysReverseFilter(context) {\n  if (!context.nested) {\n    if (context.delta[2] === ARRAY_MOVE) {\n      context.newName = '_' + context.delta[1];\n      context.setResult([context.delta[0], parseInt(context.childName.substr(1), 10), ARRAY_MOVE]).exit();\n    }\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    if (name === '_t') {\n      continue;\n    }\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'arrays';\n\nvar reverseArrayDeltaIndex = function(delta, index, itemDelta) {\n  if (typeof index === 'string' && index[0] === '_') {\n    return parseInt(index.substr(1), 10);\n  } else if (isArray(itemDelta) && itemDelta[2] === 0) {\n    return '_' + index;\n  }\n\n  var reverseIndex = +index;\n  for (var deltaIndex in delta) {\n    var deltaItem = delta[deltaIndex];\n    if (isArray(deltaItem)) {\n      if (deltaItem[2] === ARRAY_MOVE) {\n        var moveFromIndex = parseInt(deltaIndex.substr(1), 10);\n        var moveToIndex = deltaItem[1];\n        if (moveToIndex === +index) {\n          return moveFromIndex;\n        }\n        if (moveFromIndex <= reverseIndex && moveToIndex > reverseIndex) {\n          reverseIndex++;\n        } else if (moveFromIndex >= reverseIndex && moveToIndex < reverseIndex) {\n          reverseIndex--;\n        }\n      } else if (deltaItem[2] === 0) {\n        var deleteIndex = parseInt(deltaIndex.substr(1), 10);\n        if (deleteIndex <= reverseIndex) {\n          reverseIndex++;\n        }\n      } else if (deltaItem.length === 1 && deltaIndex <= reverseIndex) {\n        reverseIndex--;\n      }\n    }\n  }\n\n  return reverseIndex;\n};\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {\n    _t: 'a'\n  };\n\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    var name = child.newName;\n    if (typeof name === 'undefined') {\n      name = reverseArrayDeltaIndex(context.delta, child.childName, child.result);\n    }\n    if (delta[name] !== child.result) {\n      delta[name] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'arraysCollectChildren';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var diffFilter = function datesDiffFilter(context) {\n  if (context.left instanceof Date) {\n    if (context.right instanceof Date) {\n      if (context.left.getTime() !== context.right.getTime()) {\n        context.setResult([context.left, context.right]);\n      } else {\n        context.setResult(undefined);\n      }\n    } else {\n      context.setResult([context.left, context.right]);\n    }\n    context.exit();\n  } else if (context.right instanceof Date) {\n    context.setResult([context.left, context.right]).exit();\n  }\n};\ndiffFilter.filterName = 'dates';\n\nexports.diffFilter = diffFilter;\n","/* global diff_match_patch */\nvar TEXT_DIFF = 2;\nvar DEFAULT_MIN_LENGTH = 60;\nvar cachedDiffPatch = null;\n\nvar getDiffMatchPatch = function(required) {\n  /*jshint camelcase: false */\n\n  if (!cachedDiffPatch) {\n    var instance;\n    if (typeof diff_match_patch !== 'undefined') {\n      // already loaded, probably a browser\n      instance = typeof diff_match_patch === 'function' ?\n        new diff_match_patch() : new diff_match_patch.diff_match_patch();\n    } else if (typeof require === 'function') {\n      try {\n        var dmpModuleName = 'diff_match_patch_uncompressed';\n        var dmp = require('../../public/external/' + dmpModuleName);\n        instance = new dmp.diff_match_patch();\n      } catch (err) {\n        instance = null;\n      }\n    }\n    if (!instance) {\n      if (!required) {\n        return null;\n      }\n      var error = new Error('text diff_match_patch library not found');\n      error.diff_match_patch_not_found = true;\n      throw error;\n    }\n    cachedDiffPatch = {\n      diff: function(txt1, txt2) {\n        return instance.patch_toText(instance.patch_make(txt1, txt2));\n      },\n      patch: function(txt1, patch) {\n        var results = instance.patch_apply(instance.patch_fromText(patch), txt1);\n        for (var i = 0; i < results[1].length; i++) {\n          if (!results[1][i]) {\n            var error = new Error('text patch failed');\n            error.textPatchFailed = true;\n          }\n        }\n        return results[0];\n      }\n    };\n  }\n  return cachedDiffPatch;\n};\n\nvar diffFilter = function textsDiffFilter(context) {\n  if (context.leftType !== 'string') {\n    return;\n  }\n  var minLength = (context.options && context.options.textDiff &&\n    context.options.textDiff.minLength) || DEFAULT_MIN_LENGTH;\n  if (context.left.length < minLength ||\n    context.right.length < minLength) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  // large text, try to use a text-diff algorithm\n  var diffMatchPatch = getDiffMatchPatch();\n  if (!diffMatchPatch) {\n    // diff-match-patch library not available, fallback to regular string replace\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  var diff = diffMatchPatch.diff;\n  context.setResult([diff(context.left, context.right), 0, TEXT_DIFF]).exit();\n};\ndiffFilter.filterName = 'texts';\n\nvar patchFilter = function textsPatchFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-patch algorithm\n  var patch = getDiffMatchPatch(true).patch;\n  context.setResult(patch(context.left, context.delta[0])).exit();\n};\npatchFilter.filterName = 'texts';\n\nvar textDeltaReverse = function(delta) {\n  var i, l, lines, line, lineTmp, header = null,\n    headerRegex = /^@@ +\\-(\\d+),(\\d+) +\\+(\\d+),(\\d+) +@@$/,\n    lineHeader, lineAdd, lineRemove;\n  lines = delta.split('\\n');\n  for (i = 0, l = lines.length; i < l; i++) {\n    line = lines[i];\n    var lineStart = line.slice(0, 1);\n    if (lineStart === '@') {\n      header = headerRegex.exec(line);\n      lineHeader = i;\n      lineAdd = null;\n      lineRemove = null;\n\n      // fix header\n      lines[lineHeader] = '@@ -' + header[3] + ',' + header[4] + ' +' + header[1] + ',' + header[2] + ' @@';\n    } else if (lineStart === '+') {\n      lineAdd = i;\n      lines[i] = '-' + lines[i].slice(1);\n      if (lines[i - 1].slice(0, 1) === '+') {\n        // swap lines to keep default order (-+)\n        lineTmp = lines[i];\n        lines[i] = lines[i - 1];\n        lines[i - 1] = lineTmp;\n      }\n    } else if (lineStart === '-') {\n      lineRemove = i;\n      lines[i] = '+' + lines[i].slice(1);\n    }\n  }\n  return lines.join('\\n');\n};\n\nvar reverseFilter = function textsReverseFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-diff algorithm\n  context.setResult([textDeltaReverse(context.delta[0]), 0, TEXT_DIFF]).exit();\n};\nreverseFilter.filterName = 'texts';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","\nvar Pipe = require('../pipe').Pipe;\n\nvar Context = function Context(){\n};\n\nContext.prototype.setResult = function(result) {\n\tthis.result = result;\n\tthis.hasResult = true;\n\treturn this;\n};\n\nContext.prototype.exit = function() {\n\tthis.exiting = true;\n\treturn this;\n};\n\nContext.prototype.switchTo = function(next, pipe) {\n\tif (typeof next === 'string' || next instanceof Pipe) {\n\t\tthis.nextPipe = next;\n\t} else {\n\t\tthis.next = next;\n\t\tif (pipe) {\n\t\t\tthis.nextPipe = pipe;\n\t\t}\n\t}\n\treturn this;\n};\n\nContext.prototype.push = function(child, name) {\n\tchild.parent = this;\n\tif (typeof name !== 'undefined') {\n\t\tchild.childName = name;\n\t}\n\tchild.root = this.root || this;\n\tchild.options = child.options || this.options;\n\tif (!this.children) {\n\t\tthis.children = [child];\n\t\tthis.nextAfterChildren = this.next || null;\n\t\tthis.next = child;\n\t} else {\n\t\tthis.children[this.children.length - 1].next = child;\n\t\tthis.children.push(child);\n\t}\n\tchild.next = this;\n\treturn this;\n};\n\nexports.Context = Context;\n","/*\n\nLCS implementation that supports arrays or strings\n\nreference: http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n\n*/\n\nvar defaultMatch = function(array1, array2, index1, index2) {\n  return array1[index1] === array2[index2];\n};\n\nvar lengthMatrix = function(array1, array2, match, context) {\n  var len1 = array1.length;\n  var len2 = array2.length;\n  var x, y;\n\n  // initialize empty matrix of len1+1 x len2+1\n  var matrix = [len1 + 1];\n  for (x = 0; x < len1 + 1; x++) {\n    matrix[x] = [len2 + 1];\n    for (y = 0; y < len2 + 1; y++) {\n      matrix[x][y] = 0;\n    }\n  }\n  matrix.match = match;\n  // save sequence lengths for each coordinate\n  for (x = 1; x < len1 + 1; x++) {\n    for (y = 1; y < len2 + 1; y++) {\n      if (match(array1, array2, x - 1, y - 1, context)) {\n        matrix[x][y] = matrix[x - 1][y - 1] + 1;\n      } else {\n        matrix[x][y] = Math.max(matrix[x - 1][y], matrix[x][y - 1]);\n      }\n    }\n  }\n  return matrix;\n};\n\nvar backtrack = function(matrix, array1, array2, index1, index2, context) {\n  if (index1 === 0 || index2 === 0) {\n    return {\n      sequence: [],\n      indices1: [],\n      indices2: []\n    };\n  }\n\n  if (matrix.match(array1, array2, index1 - 1, index2 - 1, context)) {\n    var subsequence = backtrack(matrix, array1, array2, index1 - 1, index2 - 1, context);\n    subsequence.sequence.push(array1[index1 - 1]);\n    subsequence.indices1.push(index1 - 1);\n    subsequence.indices2.push(index2 - 1);\n    return subsequence;\n  }\n\n  if (matrix[index1][index2 - 1] > matrix[index1 - 1][index2]) {\n    return backtrack(matrix, array1, array2, index1, index2 - 1, context);\n  } else {\n    return backtrack(matrix, array1, array2, index1 - 1, index2, context);\n  }\n};\n\nvar get = function(array1, array2, match, context) {\n  context = context || {};\n  var matrix = lengthMatrix(array1, array2, match || defaultMatch, context);\n  var result = backtrack(matrix, array1, array2, array1.length, array2.length, context);\n  if (typeof array1 === 'string' && typeof array2 === 'string') {\n    result.sequence = result.sequence.join('');\n  }\n  return result;\n};\n\nexports.get = get;\n"]}